VIZWeb3D['Drawing']=function(a,b,c){var d=this,e=new VIZWeb3D['EventDispatcher'](window,container);this['EventHandler']=e;var f=new THREE['Scene'](),g=a,h=new THREE['Object3D'](),i,j=[],k=[],l=![],m=![],n=new Map(),o=new Map(),p,q=function(){var B={'id':g['Data']['UUIDv4'](),'items':[]};return B;},r,s=function(){var B={'id':g['Data']['UUIDv4'](),'type':d['DrawingType'],'color':{'Line':{'r':g['Configuration']['Drawing']['Color']['Line']['r'],'g':g['Configuration']['Drawing']['Color']['Line']['g'],'b':g['Configuration']['Drawing']['Color']['Line']['b'],'a':g['Configuration']['Drawing']['Color']['Line']['a']}},'width':g['Configuration']['Drawing']['Width'],'obj':{'line':null}};return B;};t();function t(){f['matrixAutoUpdate']=![],f['add'](b),f['add'](h);}function u(){j=[];var B=new THREE['Geometry']();let C=new MeshLine();C['setGeometry'](B);let D=new THREE['Vector2'](0x64,0x64),E={'color':new THREE['Color'](g['Configuration']['Drawing']['Color']['Line']['r']/0xff,g['Configuration']['Drawing']['Color']['Line']['g']/0xff,g['Configuration']['Drawing']['Color']['Line']['b']/0xff),'opacity':g['Configuration']['Drawing']['Color']['Line']['a'],'resolution':D,'lineWidth':g['Configuration']['Drawing']['Width']/0x3e8,'transparent':!![],'depthTest':![],'side':THREE['DoubleSide']};var F=new MeshLineMaterial(E);i=new THREE['Mesh'](C['geometry'],F),r=s(),r['obj']['line']=i,A(),i['userData']=r;if(p!==undefined)p['items']['push'](i);h['add'](i);}function v(B,C){var D=[],E=new THREE['Vector2']()['subVectors'](C,B),F=Math['abs'](E['x']),G=Math['abs'](E['y']),H=C['distanceTo'](B),I=new THREE['Vector2']()['copy'](B);for(var J=0x0;J<=0x168;J+=0x6){var K=J/0xb4*3.141592654,L,M;m?(L=I['x']+Math['cos'](K)*H,M=I['y']+Math['sin'](K)*H):(L=I['x']+Math['cos'](K)*F,M=I['y']+Math['sin'](K)*G);var N=g['Data']['GetMousePos_1'](L,M),O=new THREE['Vector3'](N['x'],N['y'],0x0)['unproject'](b);D['push'](O['x'],O['y'],O['z']);}var P=new THREE['BufferGeometry']();return P['addAttribute']('position',new THREE['Float32BufferAttribute'](D,0x3)),P['computeBoundingSphere'](),P;}function w(B,C){var D=[],E=g['Data']['GetMousePos_1'](B['x'],B['y']),F=g['Data']['GetMousePos_1'](C['x'],C['y']),G=new THREE['Vector3'](E['x'],E['y'],0x0)['unproject'](b);D['push'](G['x'],G['y'],G['z']),G=new THREE['Vector3'](E['x'],F['y'],0x0)['unproject'](b),D['push'](G['x'],G['y'],G['z']),G=new THREE['Vector3'](F['x'],F['y'],0x0)['unproject'](b),D['push'](G['x'],G['y'],G['z']),G=new THREE['Vector3'](F['x'],E['y'],0x0)['unproject'](b),D['push'](G['x'],G['y'],G['z']),G=new THREE['Vector3'](E['x'],E['y'],0x0)['unproject'](b),D['push'](G['x'],G['y'],G['z']);var H=new THREE['BufferGeometry']();return H['addAttribute']('position',new THREE['Float32BufferAttribute'](D,0x3)),H['computeBoundingSphere'](),H;}function x(B,C){var D=[],E=g['Data']['GetMousePos_1'](B['x'],B['y']),F=g['Data']['GetMousePos_1'](C['x'],C['y']),G=new THREE['Vector3'](E['x'],E['y'],0x0)['unproject'](b);D['push'](G['x'],G['y'],G['z']),G=new THREE['Vector3'](F['x'],F['y'],0x0)['unproject'](b),D['push'](G['x'],G['y'],G['z']);var H=new THREE['BufferGeometry']();return H['addAttribute']('position',new THREE['Float32BufferAttribute'](D,0x3)),H['computeBoundingSphere'](),H;}function y(){var B;if(d['DrawingType']===DRAWING_TYPES['FREE']){B=new THREE['Geometry']();for(var C=0x0;C<j['length'];C++){B['vertices']['push'](new THREE['Vector3'](j[C]['x'],j[C]['y'],j[C]['z']));}}d['DrawingType']===DRAWING_TYPES['CIRCLE']&&(B=v(j[0x0],j[0x1]));d['DrawingType']===DRAWING_TYPES['QUADRANGLE']&&(B=w(j[0x0],j[0x1]));d['DrawingType']===DRAWING_TYPES['LINE']&&(B=x(j[0x0],j[0x1]));let D=new MeshLine();D['setGeometry'](B),i['geometry']=D['geometry'];}function z(){if(d['DrawingType']===DRAWING_TYPES['FREE']){var B=new THREE['LineGeometry']();k=[];for(var C=0x0;C<j['length'];C++){k['push'](j[C]['x'],j[C]['y'],j[C]['z']);}B['setPositions'](k),console['log'](k['length']),matLine=new THREE['LineMaterial']({'color':new THREE['Color'](g['Configuration']['Drawing']['Color']['Line']['r']/0xff,g['Configuration']['Drawing']['Color']['Line']['g']/0xff,g['Configuration']['Drawing']['Color']['Line']['b']/0xff),'linewidth':g['Configuration']['Drawing']['Width']/0x3e8,'dashed':![]}),matLine['transparent']=!![],matLine['depthTest']=![],matLine['uniforms']['opacity']=g['Configuration']['Drawing']['Color']['Line']['a'];var D=new THREE['Line2'](B,matLine);h['add'](D);}}function A(){n['set'](r['id'],r);}this['Option']={get 'PressShift'(){return m;},set 'PressShift'(B){m=B,l&&(y(),g['RenderEvent']=!![]);}},this['DrawingMode']=![],this['DrawingType']=DRAWING_TYPES['NONE'],this['Start']=function(B){p=new q(),o['set'](p['id'],p),d['DrawingMode']=!![],d['DrawingType']=B;for(var C=0x0;C<h['children']['length'];C++){h['children'][C]['visible']=![];}},this['Continue']=function(B){d['DrawingMode']=!![],d['DrawingType']=B;},this['End']=function(){d['DrawingMode']=![],d['DrawingType']=DRAWING_TYPES['NONE'],d['EventHandler']['dispatchEvent'](EVENT_TYPES['Control']['Changed']);},this['DeleteAll']=function(){for(var B=p['items']['length']-0x1;B>=0x0;B--){g['Data']['Dispose'](p['items'][B]),p['items']['splice'](B);}g['Render']();},this['onMouseDown']=function(B){var C;B=B||window['event'];if('which'in B)C=B['which']===0x3;else{if('button'in B)C=B['button']===0x2;}if(C)return;var D=new THREE['Vector2']();if(g['Browser']['Platform']===PLATFORM_TYPES['Mobile']){var E=B['changedTouches'][0x0]['pageX'],F=B['changedTouches'][0x0]['pageY'];D['set'](E,F);}else D['set'](B['clientX'],B['clientY']);d['DrawingType']===DRAWING_TYPES['FREE']&&(l=!![],u()),(d['DrawingType']===DRAWING_TYPES['CIRCLE']||d['DrawingType']===DRAWING_TYPES['QUADRANGLE']||d['DrawingType']===DRAWING_TYPES['LINE'])&&(l=!![],u(),j['push'](D),j['push'](D));},this['onMouseMove']=function(B){if(l){if(c){var C=new THREE['Vector2']();if(g['Browser']['Platform']===PLATFORM_TYPES['Mobile']){var D=B['changedTouches'][0x0]['pageX'],E=B['changedTouches'][0x0]['pageY'];C['set'](D,E);}else C['set'](B['clientX'],B['clientY']);if(d['DrawingType']===DRAWING_TYPES['FREE']){C=g['Data']['GetMousePos_1'](C['x'],C['y']);var F=new THREE['Vector3'](C['x'],C['y'],0x0)['unproject'](b);j['push'](F),y(),i['geometry']['attributes']['position']['needsUpdate']=!![],g['RenderEvent']=!![];}(d['DrawingType']===DRAWING_TYPES['CIRCLE']||d['DrawingType']===DRAWING_TYPES['QUADRANGLE']||d['DrawingType']===DRAWING_TYPES['LINE'])&&(j[0x1]=C,y(),g['RenderEvent']=!![]);}}},this['onMouseUp']=function(B){l=![];},this['Render']=function(){d['DrawingMode']&&(c['clearDepth'](),c['render'](f,b));};};