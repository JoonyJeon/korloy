function DataManager(a,b,c){this['container']=a,this['camera']=b,this['raycaster']=c,this['list_vertex']=[],this['list_normal']=[],this['list_face']=[],this['list_mesh']=[],this['list_model']=[],this['list_colormesh']=[],this['list_colorface']=[],this['selectItem']=null,this['selectmesh']=null,this['selectmeshbackup']=null,this['mColors']=[],this['mColorCount']=0x0,this['mSelectedModels']=[],this['mSelectObjects']=[],this['mSelectPartName']=[],this['mParts']=[],this['mTree']=[],this['mHideParts']=[],this['mTreeCount']=0x0;var d=[],e=new THREE['Vector3'](0x0,0x0,0x0),f=new THREE['Vector3'](0x0,0x0,0x0),g={'min':e,'max':f};this['RootNode']={'ID':-0x1,'PID':-0x1,'bbox':g,'children':d,'filename':''},this['PROJECTIONMODE']={'PERSPECTIVE':0x1,'ORTHOGRAPHIC':0x0},this['mCameraMode']=this['PROJECTIONMODE']['PERSPECTIVE'],this['bSelectProcess']=![],this['bPlasticMode']=![];}DataManager['prototype']['Clear']=function(){this['list_vertex']=[],this['list_normal']=[],this['list_face']=[],this['list_mesh']=[],this['list_model']=[],this['list_colormesh']=[],this['list_colorface']=[];},DataManager['prototype']['AddFace']=function(a,b){this['list_face']['push'](b);},DataManager['prototype']['AddColorFace']=function(a,b){var c=this['ContainsColorFace'](a);if(c>=0x0)this['list_colorface'][c]['faces']['push'](b);else{var d=[];d['push'](b),this['list_colorface']['push']({'color':a,'faces':d});}},DataManager['prototype']['AddMesh']=function(a,b,c,d,e,f){var g=this['ContainsMesh'](a),h=null;if(g>=0x0){this['list_mesh'][g]['startIdx']<b&&(this['list_mesh'][g]['startIdx']=b);this['list_mesh'][g]['count']+=c;for(var j=0x0;j<e['length'];j++){this['list_mesh'][g]['faces']['push'](e[j]);}h=this['list_mesh'][g];}else h=this['Mesh'](a,b,c,d,e,f),this['list_mesh']['push'](h);var k=this['ContainsColorMesh'](d);if(k>=0x0)this['list_colormesh'][k]['meshes']['push'](h);else{var l=[];l['push'](h);var m={'color':d,'meshes':l};this['list_colormesh']['push'](m);}},DataManager['prototype']['GetColorCount']=function(){return this['mColorCount'];},DataManager['prototype']['ContainsColorTable']=function(a){for(var b=0x0;b<this['mColors']['length'];b++){var c=this['mColors'][b];if(c['r']===a['r']&&c['g']===a['g']&&c['b']===a['b']&&c['a']===a['a'])return!![];}return![];},DataManager['prototype']['GetColorIndex']=function(a){for(var b=0x1;b<this['mColors']['length'];b++){var c=this['mColors'][b];if(this['mColors'][b]['r']===a['r']&&this['mColors'][b]['g']===a['g']&&this['mColors'][b]['b']===a['b']&&this['mColors'][b]['a']===a['a'])return b;}return-0x1;},DataManager['prototype']['GetColor']=function(a){for(var b=0x1;b<this['mColors']['length'];b++){var c=this['mColors'][b];if(this['mColors'][b]['r']===a['r']&&this['mColors'][b]['g']===a['g']&&this['mColors'][b]['b']===a['b']&&this['mColors'][b]['a']===a['a'])return this['mColors'][b];}return null;},DataManager['prototype']['AddColorTable']=function(a){var b=this['mColors']['length'],a={'index':b,'r':a['r'],'g':a['g'],'b':a['b'],'a':a['a']};return this['mColors'][this['mColors']['length']]=a,a;},DataManager['prototype']['GetTreeCount']=function(){return this['mTreeCount'];},DataManager['prototype']['SetTreeData']=function(a){this['mTree']['push'](a);},DataManager['prototype']['SetTreeHierarchy']=function(a){var b=this['GetRootNode']();b!==null&&(b={'ID':b['ID'],'PID':b['PID'],'bbox':b['bbox'],'children':b['children'],'filename':a},this['RootNode']['children']['push'](b),this['SetSubTreeHierarchy'](b));for(var c=0x0;c<this['RootNode']['children']['length'];c++){c===0x0?(this['RootNode']['bbox']['min']=this['RootNode']['children'][c]['bbox']['min'],this['RootNode']['bbox']['max']=this['RootNode']['children'][c]['bbox']['max']):(this['RootNode']['bbox']['min']=this['Min'](this['RootNode']['bbox']['min'],this['RootNode']['children'][c]['bbox']['min']),this['RootNode']['bbox']['max']=this['Max'](this['RootNode']['bbox']['max'],this['RootNode']['children'][c]['bbox']['max']));}this['mTreeCount']=this['mTree']['length'];},DataManager['prototype']['SetSubTreeHierarchy']=function(a){for(var b=0x0;b<this['mTree']['length'];b++){this['mTree'][b]['PID']===a['ID']&&(a['children']['push'](this['mTree'][b]),this['SetSubTreeHierarchy'](this['mTree'][b]));}},DataManager['prototype']['GetRootNode']=function(){var a=null;for(var b=0x0;b<this['mTree']['length'];b++){if(this['mTree'][b]['PID']===-0x1){a=this['mTree'][b];break;}}return a;},DataManager['prototype']['ContainsNode']=function(a){var b=-0x1;for(var c=0x0;c<this['mTree']['length'];c++){if(this['mTree'][c]['ID']===a){b=c;break;}}return b;},DataManager['prototype']['UpdateNode']=function(a){var b=this;for(var c=0x0;c<b['mTree']['length'];c++){b['mTree'][c]['ID']===a['ID']&&console['log']('');}for(var c=0x0;c<b['RootNode']['children']['length'];c++){b['UpdateSubNode'](a,b['RootNode']['children'][c]);}},DataManager['prototype']['UpdateSubNode']=function(a,b){var c=this;for(var d=0x0;d<b['children']['length'];d++){var e=b['children'][d];if(e['children']!==null){if(e['children']['length']>0x0)c['UpdateSubNode'](a,e);}else e['ID']===a['ID']&&(e=a);}},DataManager['prototype']['SetPartData']=function(a){var b=this['ContainsNode'](a['ID']);b>=0x0&&this['mTree'][b]['children']['push'](a);},DataManager['prototype']['ContainsFace']=function(a){var b=-0x1;for(var c=0x0;c<this['list_face']['length'];c++){if(this['list_face'][c]['color']===a){b=c;break;}}return b;},DataManager['prototype']['ContainsColorFace']=function(a){var b=-0x1;for(var c=0x0;c<this['list_colorface']['length'];c++){if(this['list_colorface'][c]['color']===a){b=c;break;}}return b;},DataManager['prototype']['ContainsColorMesh']=function(a){var b=-0x1;for(var c=0x0;c<this['list_colormesh']['length'];c++){if(this['list_colormesh'][c]['color']===a){b=c;break;}}return b;},DataManager['prototype']['ContainsMesh']=function(a){var b=-0x1;for(var c=0x0;c<this['list_mesh']['length'];c++){if(this['list_mesh'][c]['name']['localeCompare'](a)===0x0){b=c;break;}}return b;},DataManager['prototype']['Mesh']=function Mesh(a,b,c,d,e,f){return{'name':a,'startIdx':b,'count':c,'colorIdx':d,'faces':e,'ID':f};},DataManager['prototype']['GetPart']=function(a,b){var c=[],d=0x0;for(var e=0x0;e<b['children']['length'];e++){for(var f=0x0;f<b['children'][e]['children']['length'];f++){var g=b['children'][e]['children'][f];if(g['visible']===![])continue;var h=g['geometry']['attributes']['parts']['array'];for(var j=0x0;j<h['length'];j++){var k=h[j];k['name']['localeCompare'](a)===0x0&&(c['push']({'mesh':g,'part':k,'partIdx':j,'parent':b['children'][e]}),d=d+k['count']);}}}var l=null;if(d>0x0){var m=new Float32Array(d),n=new Float32Array(d),o=0x0;for(var p=0x0;p<c['length'];p++){var q=c[p],r=q['mesh']['geometry']['attributes']['position']['array'],s=q['mesh']['geometry']['attributes']['normal']['array'],k=q['part'];for(var t=0x0;t<k['count'];t++){m[t+o]=r[t+k['startIdx']],n[t+o]=s[t+k['startIdx']];}o=o+k['count'];}var u=new THREE['BufferGeometry']();u['addAttribute']('position',new THREE['BufferAttribute'](m,0x3)),u['addAttribute']('normal',new THREE['BufferAttribute'](n,0x3)),u['computeBoundingSphere']();var v=new THREE['MeshPhongMaterial']({'color':0xffff00,'side':THREE['DoubleSide'],'transparent':!![],'vertexColors':THREE['NoColors']});l=new THREE['Mesh'](u,v);if(!l['userData']['init']){var w=this['Tag']();l['userData']=w;}l['userData']['modelsTmp']=c,l['name']=a;}return l;},DataManager['prototype']['GetParts']=function(a,b){var c=this,d=[],e=0x0;for(var f=0x0;f<b['children']['length'];f++){for(var g=0x0;g<b['children'][f]['children']['length'];g++){var h=b['children'][f]['children'][g],j=h['geometry']['attributes']['parts']['array'];for(var k=0x0;k<j['length'];k++){var l=j[k],m=![];for(var n=0x0;n<a['length'];n++){if(l['name']['localeCompare'](a[n])===0x0){m=!![];break;}}m&&(d['push']({'mesh':h,'part':l,'partIdx':k,'parent':b['children'][f]}),e=e+l['count']);}}}var o=null;if(e>0x0){var p=new Float32Array(e),q=new Float32Array(e),r=0x0;for(var s=0x0;s<d['length'];s++){var t=d[s],u=t['mesh']['geometry']['attributes']['position']['array'],v=t['mesh']['geometry']['attributes']['normal']['array'],l=t['part'];for(var w=0x0;w<l['count'];w++){p[w+r]=u[w+l['startIdx']],q[w+r]=v[w+l['startIdx']];}r=r+l['count'];}var x=new THREE['BufferGeometry']();x['addAttribute']('position',new THREE['BufferAttribute'](p,0x3)),x['addAttribute']('normal',new THREE['BufferAttribute'](q,0x3)),x['computeBoundingSphere']();var y=new THREE['MeshPhongMaterial']({'color':0xffff00,'side':THREE['DoubleSide'],'transparent':!![],'vertexColors':THREE['NoColors']});o=new THREE['Mesh'](x,y);if(!o['userData']['init']){var z=this['Tag']();o['userData']=z;}o['userData']['modelsTmp']=d,o['name']=name;}return o;},DataManager['prototype']['FindParts']=function(a,b,c){var d=[],e=0x0,f=new RegExp(a,'i'),g=[];for(var h=0x0;h<b['children']['length'];h++){for(var i=0x0;i<b['children'][h]['children']['length'];i++){var j=b['children'][h]['children'][i];if(c===![]&&j['visible']===![])continue;var k=j['geometry']['attributes']['parts']['array'];for(var l=0x0;l<k['length'];l++){var m=k[l];if(f['test'](m['name'])===!![]){var n=![],o=0x0;for(var p=0x0;p<g['length'];p++){if(m['name']['localeCompare'](g[p])===0x0){n=!![],o=p;break;}}if(!n)g['push']({'name':m['name'],'count':m['count']});else g[o]['count']=g[o]['count']+m['count'];}}}}var q=[];for(var p=0x0;p<g['length'];p++){q['push'](g[p]['name']);}return q;},DataManager['prototype']['HidePart']=function(a,b){var c=this,d=c['GetPart'](a,b);if(d===null)return;for(var e=0x0;e<d['userData']['modelsTmp']['length'];e++){var f=d['userData']['modelsTmp'][e]['part'];f['visible']=![];if(c['ContainsHidePart'](a))continue;c['mHideParts']['push'](f);}c['SetAllPartColor'](b);},DataManager['prototype']['HideParts']=function(a,b){var c=this,d=c['GetParts'](a,b);if(d===null)return;for(var e=0x0;e<d['userData']['modelsTmp']['length'];e++){var f=d['userData']['modelsTmp'][e]['part'];f['visible']=![];if(c['ContainsHidePart'](f['name']))continue;c['mHideParts']['push'](f);}c['SetAllPartColor'](b);},DataManager['prototype']['ContainsHidePart']=function(a){var b=this;for(var c=0x0;c<b['mHideParts']['length'];c++){if(b['mHideParts'][c]['name']['localeCompare'](a)===0x0)return!![];}return![];},DataManager['prototype']['ShowPart']=function(a,b){var c=this;for(var d=c['mHideParts']['length']-0x1;d>=0x0;d--){var e=c['mHideParts'][d];e['name']['localeCompare'](a)===0x0&&(e['visible']=!![],c['mHideParts']['splice'](d,0x1));}c['SetAllPartColor'](b);},DataManager['prototype']['ShowParts']=function(a,b){var c=this;for(var d=c['mHideParts']['length']-0x1;d>=0x0;d--){var e=c['mHideParts'][d],f=![];for(var g=0x0;g<a['length'];g++){if(e['name']['localeCompare'](a[g])===0x0){f=!![];break;}}f&&(e['visible']=!![],c['mHideParts']['splice'](d,0x1));}c['SetAllPartColor'](b);},DataManager['prototype']['GetPartListName']=function(a){var b=this,c=[];for(var d=0x0;d<a['children']['length'];d++){for(var e=0x0;e<a['children'][d]['children']['length'];e++){var f=a['children'][d]['children'][e],g=f['geometry']['attributes']['parts']['array'];for(var h=0x0;h<g['length'];h++){var i=g[h];b['ContainsPartListName'](c,i['name'])!==!![]&&c['push'](i['name']);}}}return c;},DataManager['prototype']['GetPartList']=function(a){var b=this,c=[];for(var d=0x0;d<a['children']['length'];d++){for(var e=0x0;e<a['children'][d]['children']['length'];e++){var f=a['children'][d]['children'][e],g=f['geometry']['attributes']['parts']['array'];for(var h=0x0;h<g['length'];h++){var i=g[h];b['ContainsPartList'](c,i['name'])!==!![]&&c['push']({'name':i['name']});}}}return c;},DataManager['prototype']['ContainsPartList']=function(a,b){for(var c=0x0;c<a['length'];c++){if(b['localeCompare'](a[c]['name'])===0x0)return!![];}return![];},DataManager['prototype']['ContainsPartListName']=function(a,b){for(var c=0x0;c<a['length'];c++){if(b['localeCompare'](a[c])===0x0)return!![];}return![];},DataManager['prototype']['GetSelectPart']=function(){var a=this,b=[];for(var c=0x0;c<a['mSelectObjects']['length'];c++){var d=a['mSelectObjects'][c];b['push'](d['name']);}return b;},DataManager['prototype']['SelectModel']=function(a,b,c,d){var e=this;e['bSelectProcess']=!![],e['UnSelectModel'](c),e['HitTestNode'](a,b,d);if(e['mSelectedModels']['length']>0x0){var f=new THREE['Object3D'](),g='';for(var h=0x0;h<e['mSelectedModels']['length'];h++){var k=e['mSelectedModels'][h]['part']['mesh'],l=e['mSelectedModels'][h]['part'],m=k['geometry']['attributes']['position']['array'],n=k['geometry']['attributes']['normal']['array'],o=new Float32Array(l['count']),p=new Float32Array(l['count']);for(var q=0x0;q<l['count'];q++){o[q]=m[q+l['startIdx']],p[q]=n[q+l['startIdx']];}var r=new THREE['BufferGeometry']();r['addAttribute']('position',new THREE['BufferAttribute'](o,0x3)),r['addAttribute']('normal',new THREE['BufferAttribute'](p,0x3)),r['computeBoundingBox'](),r['computeBoundingSphere']();var s=new THREE['MeshPhongMaterial']({'color':0xff0000,'side':THREE['DoubleSide'],'transparent':!![],'vertexColors':THREE['NoColors']}),t=new THREE['Mesh'](r,s);t['name']=l['name'];if(!t['userData']['init']){var u=this['Tag']();u['opacity']=0x1,t['userData']=u;}t['userData']['partTmp']=l,t['userData']['mesh']=k,f['add'](t);}var v=new THREE['Vector2']();v['set'](d['x'],d['y']),projector=new THREE['Projector']();if(this['mCameraMode']===this['PROJECTIONMODE']['PERSPECTIVE']){var w=new THREE['Vector3'](v['x'],v['y'],0.5);projector['unprojectVector'](w,e['camera']);var x=w['sub'](e['camera']['position'])['normalize']();e['raycaster']=new THREE['Raycaster'](e['camera']['position'],x);}else{var y=new THREE['Vector3'](v['x'],v['y'],-0x1);projector['unprojectVector'](y,e['camera']);var z=new THREE['Vector3'](0x0,0x0,-0x1)['transformDirection'](camera['matrixWorld']);e['raycaster']=new THREE['Raycaster'](),e['raycaster']['set'](y,z);}if(f['children']['length']>0x0){var A=e['raycaster']['intersectObjects'](f['children'],!![]);if(A['length']>0x0){console['log']('intersect:\x20'+A[0x0]['object']['name']);for(var h=0x0;h<f['children']['length'];h++){var B=f['children'][h];B['name']['localeCompare'](A[0x0]['object']['name'])===0x0&&(B['userData']['partTmp']['selected']=!![],e['mSelectObjects']['push'](B['userData']['partTmp']));}e['SetAllPartColor'](c);}else console['log']('no\x20intersect');}else{}}else{}e['bSelectProcess']=![];},DataManager['prototype']['SelectParts']=function(a,b){var c=this;c['UnSelectModel'](b);for(var d=0x0;d<b['children']['length'];d++){for(var e=0x0;e<b['children'][d]['children']['length'];e++){var f=b['children'][d]['children'][e],g=f['geometry']['attributes']['parts']['array'];for(var h=0x0;h<g['length'];h++){var j=g[h],l=![];for(var m=0x0;m<a['length'];m++){if(j['name']['localeCompare'](a[m])===0x0){l=!![];break;}}l&&(j['selected']=!![],c['mSelectObjects']['push'](j));}}}c['SetAllPartColor'](b);},DataManager['prototype']['UnSelectModel']=function(a){var b=this;for(var c=0x0;c<b['mSelectObjects']['length'];c++){var d=b['mSelectObjects'][c];d['selected']=![];}b['SetAllPartColor'](a),b['mSelectedModels']=[],b['mSelectObjects']=[];},DataManager['prototype']['HitTestNode']=function(a,b,c){var d=this,e=new THREE['Vector2']();e['set'](c['x'],c['y']);var f=d['RootNode'],g=f['bbox'],h=new THREE['Vector3']((g['max']['x']+g['min']['x'])/0x2,(g['max']['y']+g['min']['y'])/0x2,(g['max']['z']+g['min']['z'])/0x2),i=new THREE['Vector3'](e['x'],e['y'],0.3),j=new THREE['Vector3'](e['x'],e['y'],0.7),k=i['unproject'](d['camera']),l=j['unproject'](d['camera']),m=new THREE['Vector3']();m['subVectors'](h,k);var n=new THREE['Vector3']();n['subVectors'](h,l);var o=new THREE['Vector3']();o['crossVectors'](m,n);var p=new THREE['Vector3']();p['subVectors'](k,l);var q=o['length']()/p['length'](),r=new THREE['Vector3'](g['max']['x']-g['min']['x'],g['max']['y']-g['min']['y'],g['max']['z']-g['min']['z'])['length']();r/=1.9,q<r&&d['HitTestSubNode'](a,b,c,f);},DataManager['prototype']['HitTestSubNode']=function(a,b,c,d){var e=this,f=new THREE['Vector2']();f['set'](c['x'],c['y']);for(var g=0x0;g<d['children']['length'];g++){var h=d['children'][g],j=h['bbox'],k=new THREE['Vector3']((j['max']['x']+j['min']['x'])/0x2,(j['max']['y']+j['min']['y'])/0x2,(j['max']['z']+j['min']['z'])/0x2),l=new THREE['Vector3'](f['x'],f['y'],0.3),m=new THREE['Vector3'](f['x'],f['y'],0.7),n=l['unproject'](e['camera']),o=m['unproject'](e['camera']),p=new THREE['Vector3']();p['subVectors'](k,n);var q=new THREE['Vector3']();q['subVectors'](k,o);var r=new THREE['Vector3']();r['crossVectors'](p,q);var s=new THREE['Vector3']();s['subVectors'](n,o);var t=r['length']()/s['length'](),u=new THREE['Vector3'](j['max']['x']-j['min']['x'],j['max']['y']-j['min']['y'],j['max']['z']-j['min']['z'])['length']();u/=1.9;if(t<u){if(h['children']!==null){if(h['children']['length']>0x0)e['HitTestSubNode'](a,b,c,h);}else e['mSelectedModels']['push']({'part':h,'mesh':h['mesh']});}}};function get_screen_xy(a){var b=this,c=new THREE['Vector3'](0x0,0x0,0x0);c['x']=a[0x0],c['y']=a[0x1],c['z']=a[0x2],projScreenMat=new THREE['Matrix4'](),projScreenMat['multiplyMatrices'](b['camera']['projectionMatrix'],b['camera']['matrixWorldInverse']),c['applyProjection'](projScreenMat);var d=b['container']['getBoundingClientRect']();return{'x':(c['x']+0x1)*d['width']/0x2-d['left'],'y':(-c['y']+0x1)*d['height']/0x2+d['top'],'z':c['z']};}function get_screen_xyByVector(a){var b=a['clone']();projScreenMat=new THREE['Matrix4'](),projScreenMat['multiplyMatrices'](camera['projectionMatrix'],camera['matrixWorldInverse']),b['applyProjection'](projScreenMat);var c=container['getBoundingClientRect']();return{'x':(b['x']+0x1)*(c['width']+container['offsetLeft'])/0x2+container['offsetLeft']/0x2,'y':(-b['y']+0x1)*(c['height']+container['offsetTop'])/0x2+container['offsetTop']/0x2,'z':b['z']};}function IsPointInTriangle2D(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o;i=e-c,j=f-d,k=a-c,l=b-d,m=i*l-j*k,i=g-e,j=h-f,k=a-e,l=b-f,n=i*l-j*k,i=c-g,j=d-h,k=a-g,l=b-h,o=i*l-j*k;if(m<=0x0&&n<=0x0&&o<=0x0||m>=0x0&&n>=0x0&&o>=0x0)return!![];return![];}function GetPlaneBy3Pt(a,b,c){var d=new Float32Array([0x1,0x0,0x0,0x0]),e=new Float32Array([b['x']-a['x'],b['y']-a['y'],b['z']-a['z']]),f=new Float32Array([c['x']-a['x'],c['y']-a['y'],c['z']-a['z']]),g=new Float32Array([e[0x1]*f[0x2]-e[0x2]*f[0x1],e[0x2]*f[0x0]-e[0x0]*f[0x2],e[0x0]*f[0x1]-e[0x1]*f[0x0]]),h=Math['sqrt'](g[0x0]*g[0x0]+g[0x1]*g[0x1]+g[0x2]*g[0x2]);if(h<0.00001)return d;return g[0x0]/=h,g[0x1]/=h,g[0x2]/=h,d[0x0]=g[0x0],d[0x1]=g[0x1],d[0x2]=g[0x2],d[0x3]=-(g[0x0]*a['x']+g[0x1]*a['y']+g[0x2]*a['z']),d;}DataManager['prototype']['Min']=function(a,b){var c,d,e;if(a['x']>b['x'])c=b['x'];else c=a['x'];if(a['y']>b['y'])d=b['y'];else d=a['y'];if(a['z']>b['z'])e=b['z'];else e=a['z'];return new THREE['Vector3'](c,d,e);},DataManager['prototype']['Max']=function(a,b){var c,d,e;if(a['x']<b['x'])c=b['x'];else c=a['x'];if(a['y']<b['y'])d=b['y'];else d=a['y'];if(a['z']<b['z'])e=b['z'];else e=a['z'];return new THREE['Vector3'](c,d,e);},DataManager['prototype']['UnloadModel']=function(a,b){for(var c=b['children']['length']-0x1;c>=0x0;c--){var d=b['children'][c];if(d['name']['localeCompare'](a)===0x0){b['remove'](d);for(var e=0x0;e<d['children']['length'];e++){d['children'][e]['userData']=null,d['children'][e]['geometry']['attributes']['position']['array']=null,d['children'][e]['geometry']['attributes']['normal']['array']=null,d['children'][e]['geometry']['attributes']['parts']['array']=null,d['children'][e]['geometry']['dispose'](),d['children'][e]['material']['dispose']();}}}for(var c=this['RootNode']['children']['length']-0x1;c>=0x0;c--){var f=this['RootNode']['children'][c];f['filename']['localeCompare'](a)===0x0&&this['RootNode']['children']['splice'](c,0x1);}},DataManager['prototype']['InitPartColor']=function(a){var b=this;for(var c=0x0;c<a['children']['length'];c++){for(var d=a['children'][c]['children']['length']-0x1;d>=0x0;d--){var e=a['children'][c]['children'][d],f=e['geometry']['attributes']['parts']['array'];for(var g=f['length']-0x1;g>=0x0;g--){var h=f[g];h['colorchanged']=![],h['colorplasticchanged']=![],h['colorplastic']=![];}}}b['SetAllPartColor'](a);},DataManager['prototype']['GetTreeNode']=function(a,b){var c=null;for(var d=0x0;d<a['children']['length'];d++){var e=a['children'][d];if(e['ID']===b)return c=e,c;if(e['children']!==null){c=this['GetTreeNode'](e,b);if(c!==null)return c;}}return c;},DataManager['prototype']['RGB2HEX']=function RGB2HEX(a,c,d){return'#'+((0x1<<0x18)+(a<<0x10)+(c<<0x8)+d)['toString'](0x10)['slice'](0x1);},DataManager['prototype']['SetModelPlasticMode']=function(a,b){var c=this;for(var d=0x0;d<a['children']['length'];d++){for(var e=a['children'][d]['children']['length']-0x1;e>=0x0;e--){var f=a['children'][d]['children'][e],g=f['geometry']['attributes']['parts']['array'];for(var h=g['length']-0x1;h>=0x0;h--){var i=g[h];i['colorplastic']=b,i['colorplasticchanged']=![];}}}c['SetAllPartColor'](a);},DataManager['prototype']['Tag']=function Tag(){return{'init':!![],'opacity':0x1,'mesh':null,'model':null,'plasticmaterial':new THREE['MeshLambertMaterial']({'color':0xffffff,'transparent':!![],'opacity':0.5,'depthTest':!![],'depthWrite':![]}),'basematerial':null,'partTmp':null,'modelsTmp':null,'changecolor':![],'parts':null};},DataManager['prototype']['Part']=function Part(a,b,c,d,e,f,g,h){var i=this;return{'name':b,'startIdx':c,'count':d,'color':e,'bbox':f,'ID':a,'children':h,'selected':![],'colorchanged':![],'colorplastic':![],'colorplasticchanged':![],'visible':!![],'color_base':{'index':e,'r':i['mColors'][e]['r'],'g':i['mColors'][e]['g'],'b':i['mColors'][e]['b'],'a':i['mColors'][e]['a']},'color_change':null,'color_select':{'index':-0x1,'r':0xff,'g':0x0,'b':0x0,'a':0x1},'color_plastic':{'index':-0x1,'r':0xff,'g':0xff,'b':0xff,'a':0.5},'color_change_plastic':{'index':-0x1,'r':0xff,'g':0xff,'b':0xff,'a':0.5},'color_hide':{'index':-0x1,'r':0xff,'g':0xff,'b':0xff,'a':0x0}};},DataManager['prototype']['SetPivot']=function(a,b,c,d,e){var f=this;f['HitTestNode'](c,d,e);if(f['mSelectedModels']['length']>0x0){var g=new THREE['Object3D'](),h='';for(var k=0x0;k<f['mSelectedModels']['length'];k++){var l=f['mSelectedModels'][k]['mesh'],m=f['mSelectedModels'][k]['part'],n=l['geometry']['attributes']['position']['array'];f['selectmeshbackup']=l['geometry']['attributes']['position']['clone']();var o=l['geometry']['attributes']['normal']['array'],p=new Float32Array(m['count']),q=new Float32Array(m['count']);for(var r=0x0;r<m['count'];r++){p[r]=n[r+m['startIdx']],q[r]=o[r+m['startIdx']];}var s=new THREE['BufferGeometry']();s['addAttribute']('position',new THREE['BufferAttribute'](p,0x3)),s['addAttribute']('normal',new THREE['BufferAttribute'](q,0x3)),s['computeBoundingSphere']();var t=new THREE['MeshPhongMaterial']({'color':0xff0000,'side':THREE['DoubleSide'],'transparent':!![],'vertexColors':THREE['NoColors']}),u=new THREE['Mesh'](s,t);u['name']=m['name'];if(!u['userData']['init']){var v=this['Tag']();u['userData']=v;}u['userData']['partTmp']=m,u['userData']['mesh']=l,g['add'](u);}var w=new THREE['Vector2']();w['set'](e['x']*0x2-0x1,-(e['y']*0x2)+0x1),projector=new THREE['Projector']();if(this['mCameraMode']===this['PROJECTIONMODE']['PERSPECTIVE']){var x=new THREE['Vector3'](w['x'],w['y'],0.5);projector['unprojectVector'](x,f['camera']);var y=x['sub'](f['camera']['position'])['normalize']();f['raycaster']=new THREE['Raycaster'](f['camera']['position'],y);}else{var z=new THREE['Vector3'](w['x'],w['y'],-0x1);projector['unprojectVector'](z,f['camera']);var A=new THREE['Vector3'](0x0,0x0,-0x1)['transformDirection'](camera['matrixWorld']);f['raycaster']=new THREE['Raycaster'](),f['raycaster']['set'](z,A);}if(g['children']['length']>0x0){var B=f['raycaster']['intersectObjects'](g['children'],!![]);if(B['length']>0x0){console['log']('intersect:\x20'+B[0x0]['object']['name']);for(var k=0x0;k<g['children']['length'];k++){var C=g['children'][k];if(C['name']['localeCompare'](B[0x0]['object']['name'])===0x0){bbox=new THREE['BoundingBoxHelper'](C,0xff0000),bbox['update']();var D=new THREE['Vector3']((bbox['box']['max']['x']+bbox['box']['min']['x'])/0x2,(bbox['box']['max']['y']+bbox['box']['min']['y'])/0x2,(bbox['box']['max']['z']+bbox['box']['min']['z'])/0x2);b['bPivot']=!![],b['Pivot']=D;}}}else console['log']('no\x20intersect');}else{}}else{}},DataManager['prototype']['SetCamera']=function(a,b){b===0x0?this['mCameraMode']=this['PROJECTIONMODE']['PERSPECTIVE']:this['mCameraMode']=this['PROJECTIONMODE']['ORTHOGRAPHIC'],this['camera']=a;},DataManager['prototype']['GetColorMesh']=function(a,b,c){var d=null;for(var e=0x0;e<c['children'][b]['children']['length'];e++){var f=c['children'][b]['children'][e];if(f['userData']['color']===a['index']){d=f;break;}}return d;},DataManager['prototype']['SetPartColor']=function(c,d,e,f,h,i){var j=this,k=![],l=j['GetColor']({'r':e,'g':f,'b':h,'a':i});l===null?l=j['AddColorTable']({'r':e,'g':f,'b':h,'a':i}):k=!![];for(var m=0x0;m<d['children']['length'];m++){for(var n=d['children'][m]['children']['length']-0x1;n>=0x0;n--){var o=d['children'][m]['children'][n],p=o['geometry']['attributes']['parts']['array'];for(var q=p['length']-0x1;q>=0x0;q--){var s=p[q],t=![];c['localeCompare'](s['name'])===0x0&&s['color']!==l['index']&&(t=!![]),t&&(s['colorplastic']?(s['colorplasticchanged']=!![],s['color_change_plastic']=l):(s['colorchanged']=!![],s['color_change']=l));}}}j['SetAllPartColor'](d);},DataManager['prototype']['SetPartsColor']=function(d,e,f,h,i,j){var k=this,l=![],m=k['GetColor']({'r':f,'g':h,'b':i,'a':j});m===null?m=k['AddColorTable']({'r':f,'g':h,'b':i,'a':j}):l=!![];var n=null,o=0x0;for(var p=0x0;p<e['children']['length'];p++){n=k['GetColorMesh'](m,p,e);for(var q=e['children'][p]['children']['length']-0x1;q>=0x0;q--){var s=e['children'][p]['children'][q],t=s['geometry']['attributes']['parts']['array'];for(var u=t['length']-0x1;u>=0x0;u--){var v=t[u],w=![];for(var x=0x0;x<d['length'];x++){if(d[x]['localeCompare'](v['name'])===0x0&&v['color']!==m['index']){w=!![];break;}}w&&(v['colorplastic']?(v['colorplasticchanged']=!![],v['color_change_plastic']=m):(v['colorchanged']=!![],v['color_change']=m));}}}k['SetAllPartColor'](e);};function RGB2HEX(a,c,d){return'#'+((0x1<<0x18)+(a<<0x10)+(c<<0x8)+d)['toString'](0x10)['slice'](0x1);}DataManager['prototype']['SetAllPartColor']=function(a){var b=this,c=![],d,e=null;for(var f=0x0;f<a['children']['length'];f++){for(var g=a['children'][f]['children']['length']-0x1;g>=0x0;g--){var h=a['children'][f]['children'][g],j=h['userData']['parts'];for(var k=j['length']-0x1;k>=0x0;k--){var l=j[k];if(l['visible']===![])d=b['GetColor']({'r':l['color_hide']['r'],'g':l['color_hide']['g'],'b':l['color_hide']['b'],'a':l['color_hide']['a']}),d===null&&(d=b['AddColorTable']({'r':l['color_hide']['r'],'g':l['color_hide']['g'],'b':l['color_hide']['b'],'a':l['color_hide']['a']}));else{if(l['selected'])d=b['GetColor']({'r':l['color_select']['r'],'g':l['color_select']['g'],'b':l['color_select']['b'],'a':l['color_select']['a']}),d===null&&(d=b['AddColorTable']({'r':l['color_select']['r'],'g':l['color_select']['g'],'b':l['color_select']['b'],'a':l['color_select']['a']}));else{if(l['colorplastic'])l['colorplasticchanged']?(d=b['GetColor']({'r':l['color_change_plastic']['r'],'g':l['color_change_plastic']['g'],'b':l['color_change_plastic']['b'],'a':l['color_change_plastic']['a']}),d===null&&(d=b['AddColorTable']({'r':l['color_change_plastic']['r'],'g':l['color_change_plastic']['g'],'b':l['color_change_plastic']['b'],'a':l['color_change_plastic']['a']}))):(d=b['GetColor']({'r':l['color_plastic']['r'],'g':l['color_plastic']['g'],'b':l['color_plastic']['b'],'a':l['color_plastic']['a']}),d===null&&(d=b['AddColorTable']({'r':l['color_plastic']['r'],'g':l['color_plastic']['g'],'b':l['color_plastic']['b'],'a':l['color_plastic']['a']})));else l['colorchanged']?(d=b['GetColor']({'r':l['color_change']['r'],'g':l['color_change']['g'],'b':l['color_change']['b'],'a':l['color_change']['a']}),d===null&&(d=b['AddColorTable']({'r':l['color_change']['r'],'g':l['color_change']['g'],'b':l['color_change']['b'],'a':l['color_change']['a']}))):(d=b['GetColor']({'r':l['color_base']['r'],'g':l['color_base']['g'],'b':l['color_base']['b'],'a':l['color_base']['a']}),d===null&&(d=b['AddColorTable']({'r':l['color_base']['r'],'g':l['color_base']['g'],'b':l['color_base']['b'],'a':l['color_base']['a']})));}}e=b['GetColorMesh'](d,f,a);if(d['index']!==l['color']){var m=h['geometry']['attributes']['position']['array'],n=h['geometry']['attributes']['normal']['array'],o=m['subarray'](l['startIdx'],l['startIdx']+l['count']),p=n['subarray'](l['startIdx'],l['startIdx']+l['count']),q=new Float32Array(m['length']-l['count']),r=new Float32Array(n['length']-l['count']);q['set'](m['subarray'](0x0,l['startIdx']),0x0),q['set'](m['subarray'](l['startIdx']+l['count'],m['length']),l['startIdx']),r['set'](n['subarray'](0x0,l['startIdx']),0x0),r['set'](n['subarray'](l['startIdx']+l['count'],n['length']),l['startIdx']),newparts=j['splice'](k,0x1);for(var s=0x0;s<j['length'];s++){j[s]['startIdx']>=l['startIdx']&&(j[s]['startIdx']=j[s]['startIdx']-l['count']);}e!==h&&(h['geometry']['addAttribute']('position',new THREE['BufferAttribute'](q,0x3)),h['geometry']['addAttribute']('normal',new THREE['BufferAttribute'](r,0x3)),q['length']===0x0&&r['length']===0x0&&j['length']===0x0&&(h['userData']=null,h['geometry']['attributes']['position']['array']=null,h['geometry']['attributes']['normal']['array']=null,h['geometry']['dispose'](),h['material']['dispose'](),a['children'][f]['remove'](h)));if(e!==null){var t=e['geometry']['attributes']['position']['array'],u=e['geometry']['attributes']['normal']['array'],v=e['userData']['parts'],w=new Float32Array(t['length']+l['count']),x=new Float32Array(u['length']+l['count']);w['set'](t,0x0),x['set'](u,0x0),w['set'](o,t['length']),x['set'](p,u['length']),l['startIdx']=t['length'],l['color']=d['index'],l['mesh']=e,v['push'](l),e['geometry']['addAttribute']('position',new THREE['BufferAttribute'](w,0x3)),e['geometry']['addAttribute']('normal',new THREE['BufferAttribute'](x,0x3)),e['userData']['parts']=v;if(!l['visible'])e['visible']=![];if(l['selected'])e['renderOrder']=0x0;else e['renderOrder']=0x1;}else{q['length']===0x0&&r['length']===0x0&&j['length']===0x0&&(h['userData']=null,h['geometry']['attributes']['position']['array']=null,h['geometry']['attributes']['normal']['array']=null,h['geometry']['dispose'](),h['material']['dispose'](),a['children'][f]['remove'](h));var w=new Float32Array(l['count']),x=new Float32Array(l['count']);w['set'](o,0x0),x['set'](p,0x0);var v=[];l['startIdx']=0x0,l['color']=d['index'],v['push'](l);var y=new THREE['BufferGeometry']();y['addAttribute']('position',new THREE['BufferAttribute'](w,0x3)),y['addAttribute']('normal',new THREE['BufferAttribute'](x,0x3));var z=RGB2HEX(parseInt(d['r']),parseInt(d['g']),parseInt(d['b'])),A=new THREE['MeshPhongMaterial']({'color':z,'side':THREE['DoubleSide'],'transparent':!![],'vertexColors':THREE['NoColors'],'opacity':d['a']});meshtmp=new THREE['Mesh'](y,A),meshtmp['castShadow']=!![],l['mesh']=meshtmp,e=meshtmp;if(!meshtmp['userData']['init']){var B=b['Tag']();B['color']=d['index'],B['parts']=v,meshtmp['userData']=B;}a['children'][f]['add'](e);if(!l['visible'])e['visible']=![];if(l['selected'])e['renderOrder']=0x0;else e['renderOrder']=0x1;}}}}}for(var f=0x0;f<a['children']['length'];f++){for(var g=a['children'][f]['children']['length']-0x1;g>=0x0;g--){var h=a['children'][f]['children'][g];h['geometry']['computeBoundingSphere'](),h['geometry']['computeBoundingBox'](),h['geometry']['attributes']['position']['needsUpdate']=!![],h['geometry']['attributes']['normal']['needsUpdate']=!![];}}},DataManager['prototype']['GetBoundingBox']=function(a){var b=+Infinity,c=+Infinity,d=+Infinity,e=-Infinity,f=-Infinity,g=-Infinity;for(var h=0x0;h<a['children']['length'];h++){for(var j=a['children'][h]['children']['length']-0x1;j>=0x0;j--){var k=a['children'][h]['children'][j];if(k['visible']===!![]){var m=k['geometry']['attributes']['position']['array'];for(var n=0x0,o=m['length'];n<o;n+=0x3){var p=m[n],q=m[n+0x1],r=m[n+0x2];if(p<b)b=p;if(q<c)c=q;if(r<d)d=r;if(p>e)e=p;if(q>f)f=q;if(r>g)g=r;}}}}var s=new THREE['Vector3'](b,c,d),t=new THREE['Vector3'](e,f,g),u={'min':s,'max':t};return{'box':u};};